---
alwaysApply: true
---

# LaTeX Thesis Workflow Rules

## Reference Management

### Zotero as Single Source of Truth
- **NEVER manually edit `references_new.bib`** - this file is automatically synced from Zotero
- All bibliography changes must be made in Zotero, then exported
- To add citations:
  1. Add paper to Zotero library
  2. Export updated bibliography to `references_new.bib`
  3. Use citation key in LaTeX with `\cite{key}`
  4. Rebuild document to update references

### Citation Style Guidelines
- **Use inline citations throughout** - no paper summaries
- **No author name mentions** in the text (e.g., avoid "Smith et al. proposed...")
- **No special formatting** for citations (e.g., no bold, italics, or parenthetical explanations)
- Let citations speak through context, not explicit attribution
- Example: "Recent work on trajectory generation shows promising results~\cite{paper1,paper2}."

### Working with Citations
- Use `\cite{key}` for standard citations
- Use `\citep{key}` for parenthetical citations if needed
- Verify citation keys exist in `references_new.bib` before committing
- Check for undefined references during compilation

## Documentation Organization

### Separation of Documentation and Thesis Figures

**Documentation figures (notes/):**
- `notes/` contains self-contained documentation with embedded figures
- `notes/hoser/docs/figures/` - documentation-specific plots (Optuna visualizations, etc.)
- `notes/hoser/cross_model/` - vanilla vs distilled trajectory comparison plots
- These figures are part of the documentation and are NOT automatically copied to `assets/plots/`

**Thesis figures (assets/plots/):**
- `assets/plots/` is ONLY for figures actually referenced in `main.tex` or `sections/*.tex`
- Only copy figures to `assets/plots/` when they are needed for the thesis document

### Workflow for Using Documentation Figures in Thesis

1. When a figure from `notes/` is needed for the thesis, manually copy it to `assets/plots/`
2. Reference it in LaTeX using `\includegraphics{assets/plots/filename.pdf}`
3. Keep figure paths in notes documentation as relative paths (e.g., `figures/optuna/optimization_history.png`)

### Updating Documentation

- Update notes documentation by replacing from source projects (HOSER, LMTAD) as needed
- Documentation in `notes/` can contain markdown formatting, inline citations, and self-references
- Documentation figures remain in `notes/` structure and are not automatically copied to thesis
- Only `main.tex` and `sections/*.tex` follow strict LaTeX citation guidelines (no author names, inline citations only)

## Agent Behavior Principles

### Verification Over Assumption

**Core principle**: When uncertain about any aspect of a task, **always ask clarifying questions** rather than making assumptions. It's better to ask than to make changes that need to be reverted.

### When to Verify

**Ask clarifying questions when:**
- Citation keys or file paths are uncertain
- User intent is ambiguous or could have multiple valid interpretations
- Structural changes might have unintended consequences
- Information from different sources conflicts
- Task requirements are unclear or incomplete
- Multiple valid approaches exist with significantly different outcomes

**Proceed with confidence when:**
- Task is clearly specified with explicit requirements
- Following documented conventions and rules
- Performing routine operations (e.g., building, reading files)
- Information is verifiable from reliable sources (e.g., existing code, documentation)

### Specific Verification Guidelines

**Citations and References:**
- Before citing a paper, verify the citation key exists in `references_new.bib`
- If citation key is uncertain, search for it rather than guessing
- When adding new citations, confirm user has added paper to Zotero first

**File Operations:**
- Verify file paths before reading or modifying files
- Check file existence before operations that assume it exists
- Confirm directory structure matches expectations

**Content Changes:**
- When making significant structural changes, outline the approach first
- If user request is ambiguous, ask for clarification before proceeding
- Present options when multiple valid implementations exist

**Tool Usage:**
- Verify tool parameters before execution
- Check command syntax when uncertain
- Confirm tool availability before use

### User Responsibilities vs Agent Capabilities

**The agent CANNOT:**
- Add papers to Zotero library directly (Zotero MCP is read-only for library management)
- Manually edit `references_new.bib` (Zotero is source of truth)
- Install system packages or dependencies
- Access resources outside the workspace without permission

**The agent CAN:**
- Search for papers using Zotero MCP and ArXiv MCP
- Recommend papers to add to Zotero
- Read and analyze papers from Zotero or ArXiv
- Help with citations AFTER user adds papers to Zotero and syncs bibliography
- Edit LaTeX source files
- Run build commands and analyze output
- Search and navigate codebase and documentation

### Workflow Example: Adding Citations

**Correct workflow:**
1. Agent searches for relevant papers using MCP tools
2. Agent recommends papers to user
3. **User manually adds papers to Zotero** (agent cannot do this)
4. **User exports updated bibliography to `references_new.bib`**
5. **User runs `zotero-mcp update-db --fulltext`** (if using semantic search)
6. Agent verifies citation keys exist in `references_new.bib`
7. Agent adds citations to LaTeX document
8. Agent verifies document compiles successfully

**Incorrect workflow:**
1. Agent tries to add paper to Zotero (not supported)
2. Agent manually edits `references_new.bib` (violates Zotero as source of truth)
3. Agent assumes citation key without verification (may cause errors)

### Communication Guidelines

**When asking clarifying questions:**
- Be specific about what needs clarification
- Provide context for why verification is needed
- Offer relevant options when applicable
- Keep questions concise and actionable

**Example clarifications:**
- "I found several papers on this topic. Which one would you like to cite? Or should I recommend the most relevant ones first?"
- "The citation key could be 'smith2023privacy' or 'smith2023trajectory'. Let me check references_new.bib to verify."
- "This change could affect multiple sections. Should I update all occurrences or just this one?"
- "I can see two possible interpretations of this request. Did you mean [option A] or [option B]?"

### Error Recovery

When mistakes happen:
- Acknowledge the error clearly
- Explain what went wrong
- Propose correction approach
- Ask for confirmation before correcting
- Learn from the mistake to avoid repetition

## LaTeX Best Practices

### Document Structure
- Keep `main.tex` as the single entry point
- Use `\input{}` or `\include{}` for modular structure when needed
- Define custom commands in `custom-commands.tex`
- Maintain consistent sectioning hierarchy

### Figure Management
- Store figures in `assets/plots/`
- Use vector formats (PDF, SVG converted to PDF) when possible
- Reference all figures in text before they appear
- Use descriptive filenames (e.g., `trajectory-comparison.pdf`, not `fig1.pdf`)
- Include figure source code or generation scripts when applicable

### Table Best Practices
- Use `booktabs` package for professional tables
- Avoid vertical lines in tables
- Include units in column headers
- Reference tables before they appear in text

### Cross-References
- Use `\label{}` and `\ref{}` for all cross-references
- Label format: `\label{sec:intro}`, `\label{fig:architecture}`, `\label{tab:results}`
- Never hard-code section/figure/table numbers

### Mathematical Notation
- Define frequently used notation in `custom-commands.tex`
- Use consistent notation throughout document
- Define variables before use
- Use `\DeclareMathOperator` for custom operators

## Notes Integration

### Referencing Notes in LaTeX
- When incorporating information from project notes, **use LaTeX comments** to document the source
- Notes files are not part of the compiled document and should not be linked via LaTeX commands
- Format: `% Source: notes/hoser/docs/LMTAD-Distillation.md - Section on loss formulation`
- This maintains traceability for organization and clarity without affecting the compiled output
- Place the comment above or near the content derived from the notes

**Example:**
```latex
% Source: notes/hoser/docs/Hyperparameter-Optimization.md - Optimal hyperparameters
% Lambda=0.0014, Temperature=4.37, Window=7
The distillation process uses carefully tuned hyperparameters to balance
teacher guidance with supervised learning~\cite{hinton2015distilling}.
```

### Notes Organization
- Keep research notes in `notes/` directory (gitignored, local only)
- Use markdown for note-taking
- Notes contain documentation, figures, and reference materials from source projects
- Document methodology decisions and rationale

## Research Integration Workflow

### Adding New Research
1. **Agent**: Find paper using Zotero MCP semantic search or ArXiv MCP
2. **User**: Add paper to Zotero library (add tags, collections) - *agent cannot do this*
3. **User**: Update Zotero MCP database: `zotero-mcp update-db --fulltext`
4. **User**: Export updated bibliography to `references_new.bib`
5. **Agent**: Verify citation key exists in bibliography
6. **Agent**: Use citation in LaTeX document
7. **Agent**: Verify document compiles successfully (LaTeX Workshop handles building automatically)

### Literature Review Process
1. **Agent**: Use semantic search to find related work
2. **User**: Read and annotate papers in Zotero
3. **Agent/User**: Take notes in `notes/` directory (local references, not linked in LaTeX)
4. **Agent**: Add relevant citations to thesis sections (after user completes steps 2-4 above)
5. **User**: Maintain bibliography synchronization with Zotero

## Quality Checks

### Before Committing
- [ ] Document compiles without errors (LaTeX Workshop auto-builds on save)
- [ ] No undefined citations (`Citation 'key' on page X undefined`)
- [ ] No undefined references (`Reference 'label' on page X undefined`)
- [ ] All figures are referenced in text
- [ ] Figure/table captions are descriptive
- [ ] No overfull/underfull hbox warnings (or documented as acceptable)
- [ ] Bibliography is synchronized with Zotero
- [ ] Build artifacts remain in `build/` directory (gitignored)

### Regular Maintenance
- Keep Zotero library organized with tags and collections
- Update semantic search database after significant library changes
- Review and clean up unused custom commands
- Maintain consistent formatting throughout document

## Template-Specific Notes

### LNCS Template (Springer)
- Using `llncs.cls` document class
- Bibliography style: `splncs04.bst`
- Follow Springer formatting guidelines
- Keep template files in `llncs/` directory
- Don't modify template files unless necessary

### Custom Commands
- Define shortcuts in `custom-commands.tex`
- Document complex commands with comments
- Keep commands organized by category
- Avoid redefining standard LaTeX commands

## Error Handling

### Common Issues
1. **Undefined citations**: Check citation key spelling, verify in `references_new.bib`
2. **Missing figures**: Check file path, ensure figure file exists in `assets/`
3. **Compilation errors**: Read error message, check line number in source
4. **Bibliography not updating**: Run `latexmk` multiple times or clean build

### Debugging Process
1. Read error messages carefully (line numbers, error type)
2. Check recent changes if error is new
3. Isolate problematic section by commenting out
4. Consult LaTeX documentation or resources
5. Verify package versions and dependencies
